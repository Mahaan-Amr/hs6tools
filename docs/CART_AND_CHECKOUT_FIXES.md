# Ø±ÙØ¹ Ù…Ø´Ú©Ù„Ø§Øª Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ùˆ ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨

## âœ… Ø¨Ù‡Ø¨ÙˆØ¯ Ø¬Ø§Ù…Ø¹: Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø§Ù…Ù„ ÙØ±Ù…â€ŒÙ‡Ø§ Ùˆ Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§

### Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ

**Ù‡Ø¯Ù:**
- Ø§ÙØ²ÙˆØ¯Ù† Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ ØªÙ…Ø§Ù… ÙØ±Ù…â€ŒÙ‡Ø§ Ùˆ Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù¾Ù„ØªÙØ±Ù…
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡â€ŒØ´Ø¯Ù‡ Ø¯Ø± Ø³Ù‡ Ø²Ø¨Ø§Ù† (ÙØ§Ø±Ø³ÛŒØŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒØŒ Ø¹Ø±Ø¨ÛŒ)
- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ

**ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù‡:**

1. **QuoteForm** (`src/components/admin/crm/QuoteForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªØ§Ø±ÛŒØ® Ø§Ø¹ØªØ¨Ø§Ø± (Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø§Ø´Ø¯)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ùˆ Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„Ø§Øª
   - Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§Ù‡Ø§ÛŒ ÙÛŒÙ„Ø¯ Ø¨Ù‡ ÙÛŒÙ„Ø¯

2. **CustomerInteractionForm** (`src/components/admin/crm/CustomerInteractionForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†ÙˆØ¹ ØªØ¹Ø§Ù…Ù„
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…ÙˆØ¶ÙˆØ¹ (Ø­Ø¯Ø§Ù‚Ù„ 3 Ú©Ø§Ø±Ø§Ú©ØªØ±ØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 200 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø­ØªÙˆØ§ (Ø­Ø¯Ø§Ù‚Ù„ 10 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¬Ø§ÛŒ Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ù‡Ø§Ø±Ø¯Ú©Ø¯ Ø´Ø¯Ù‡

3. **ProfileForm** (`src/components/customer/profile/ProfileForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ (Ø­Ø¯Ø§Ù‚Ù„ 2 Ú©Ø§Ø±Ø§Ú©ØªØ±ØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 50 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† (ÙØ±Ù…Øª Ø§ÛŒØ±Ø§Ù†ÛŒ)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø®ØªÛŒØ§Ø±ÛŒ (Ø´Ø±Ú©ØªØŒ Ø³Ù…Øª)

4. **EmailSettingsForm** (`src/components/admin/settings/EmailSettingsForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø³Ø±ÙˆØ± SMTP (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 255 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù¾ÙˆØ±Øª SMTP (Ø¨ÛŒÙ† 1 ØªØ§ 65535)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§ÛŒÙ…ÛŒÙ„ ÙØ±Ø³ØªÙ†Ø¯Ù‡ (ÙØ±Ù…Øª Ø§ÛŒÙ…ÛŒÙ„)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù… ÙØ±Ø³ØªÙ†Ø¯Ù‡ (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±)

5. **PaymentSettingsForm** (`src/components/admin/settings/PaymentSettingsForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø­Ø¯Ø§Ù‚Ù„ Ù…Ø¨Ù„Øº Ø³ÙØ§Ø±Ø´ (Ø¨Ø§ÛŒØ¯ >= 0)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø¨Ù„Øº Ø³ÙØ§Ø±Ø´ (Ø¨Ø§ÛŒØ¯ > Ø­Ø¯Ø§Ù‚Ù„)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„ Ø´Ù†Ø§Ø³Ù‡ ÙØ±ÙˆØ´Ù†Ø¯Ù‡ Ùˆ Ú©Ù„ÛŒØ¯ API

6. **SystemSettingsForm** (`src/components/admin/settings/SystemSettingsForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù… Ø³Ø§ÛŒØª (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ ÙØ±Ù…Øª URL Ù…Ø¹ØªØ¨Ø±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§ÛŒÙ…ÛŒÙ„ ØªÙ…Ø§Ø³ (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ ÙØ±Ù…Øª Ø§ÛŒÙ…ÛŒÙ„)

7. **Content CategoryForm** (`src/components/admin/content/CategoryForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Slug (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø­Ø¯Ø§Ú©Ø«Ø± 500 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ù‡Ø§Ø±Ø¯Ú©Ø¯ Ø´Ø¯Ù‡ Ø¨Ø§ ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§

8. **ArticleForm** (`src/components/admin/content/ArticleForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¹Ù†ÙˆØ§Ù† Ù…Ù‚Ø§Ù„Ù‡ (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 200 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Slug (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ù‚Ø§Ù„Ù‡ (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ù‚Ù„ 50 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø®Ù„Ø§ØµÙ‡ (Ø­Ø¯Ø§Ú©Ø«Ø± 500 Ú©Ø§Ø±Ø§Ú©ØªØ±)

9. **EducationForm** (`src/components/admin/education/EducationForm.tsx`)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø³ (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 200 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Slug (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ø­ØªÙˆØ§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø¯Ø±Ø³:
     - Ø¯Ø±ÙˆØ³ Ù…ØªÙ†ÛŒ: Ù…Ø­ØªÙˆØ§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª
     - Ø¯Ø±ÙˆØ³ ÙˆÛŒØ¯ÛŒÙˆÛŒÛŒ: ÙˆÛŒØ¯ÛŒÙˆ ÛŒØ§ Ø¢Ø¯Ø±Ø³ ÙˆÛŒØ¯ÛŒÙˆ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª
     - Ø¯Ø±ÙˆØ³ ØªØ±Ú©ÛŒØ¨ÛŒ: Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø­ØªÙˆØ§ ÛŒØ§ ÙˆÛŒØ¯ÛŒÙˆ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¢Ø¯Ø±Ø³ ÙˆÛŒØ¯ÛŒÙˆ (ÙØ±Ù…Øª URL Ù…Ø¹ØªØ¨Ø±)
   - Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ ØªÙ…Ø§Ù… Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ù‡Ø§Ø±Ø¯Ú©Ø¯ Ø´Ø¯Ù‡ ÙØ§Ø±Ø³ÛŒ Ø¨Ø§ ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§

10. **EducationCategoryForm** (`src/components/admin/education/EducationCategoryForm.tsx`)
    - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±)
    - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Slug (Ø§Ù„Ø²Ø§Ù…ÛŒØŒ Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±)
    - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ§Ù„Ø¯ (Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®ÙˆØ¯Ø´ Ø¨Ø§Ø´Ø¯)
    - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø­Ø¯Ø§Ú©Ø«Ø± 500 Ú©Ø§Ø±Ø§Ú©ØªØ±)

**Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**

ØªÙ…Ø§Ù… Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¨Ù‡ Ø³Ù‡ Ø²Ø¨Ø§Ù† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯:
- `messages/fa.json` - ÙØ§Ø±Ø³ÛŒ
- `messages/en.json` - Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
- `messages/ar.json` - Ø¹Ø±Ø¨ÛŒ

**Ø³Ø§Ø®ØªØ§Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§:**
```json
{
  "admin": {
    "crm": {
      "quotes": {
        "validation": {
          "customerRequired": "...",
          "itemsRequired": "...",
          "validUntilRequired": "...",
          "validUntilInvalid": "...",
          "itemQuantityInvalid": "...",
          "itemPriceInvalid": "..."
        }
      },
      "customer360": {
        "interactions": {
          "validation": {
            "typeRequired": "...",
            "subjectRequired": "...",
            "contentRequired": "...",
            "contentMinLength": "...",
            "subjectMinLength": "...",
            "subjectMaxLength": "..."
          }
        }
      }
    },
    "contentCategoryForm": { ... },
    "articleForm": { ... },
    "educationForm": { ... },
    "educationCategoryForm": { ... }
  },
  "customer": {
    "profile": {
      "validation": { ... }
    }
  },
  "settingsPage": {
    "systemSettings": {
      "validation": { ... }
    },
    "emailSettings": {
      "validation": { ... }
    },
    "paymentSettings": {
      "validation": { ... }
    }
  }
}
```

**ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡:**

1. **Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙÛŒÙ„Ø¯ Ø¨Ù‡ ÙÛŒÙ„Ø¯:**
   - Ø®Ø·Ø§Ù‡Ø§ Ù‡Ù†Ú¯Ø§Ù… ØªØ§ÛŒÙ¾ Ú©Ø§Ø±Ø¨Ø± Ù¾Ø§Ú© Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
   - Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ Ø¯Ø± Ø²ÛŒØ± Ù‡Ø± ÙÛŒÙ„Ø¯
   - Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ border ÙÛŒÙ„Ø¯Ù‡Ø§ (Ù‚Ø±Ù…Ø² Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§)

2. **Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„:**
   - `maxLength` attribute Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…ØªÙ†ÛŒ
   - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ `minLength` Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ù‡Ù…

3. **Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…Øª:**
   - Ø§ÛŒÙ…ÛŒÙ„: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`
   - Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø§ÛŒØ±Ø§Ù†ÛŒ: `/^(\+98|0)?9\d{9}$/`
   - Ú©Ø¯ Ù¾Ø³ØªÛŒ: `/^\d{10}$/`
   - URL: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `new URL()` Ùˆ regex

4. **Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù…Ù†Ø·Ù‚ÛŒ:**
   - ØªØ§Ø±ÛŒØ® Ø§Ø¹ØªØ¨Ø§Ø± Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
   - Ø­Ø¯Ø§Ú©Ø«Ø± Ù…Ø¨Ù„Øº Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø­Ø¯Ø§Ù‚Ù„ Ø¨Ø§Ø´Ø¯
   - Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÙˆØ§Ù„Ø¯ Ø®ÙˆØ¯Ø´ Ø¨Ø§Ø´Ø¯

5. **Ø¨Ù‡Ø¨ÙˆØ¯ UX:**
   - Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§Ù‡Ø§ Ø¯Ø± Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
   - Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² submit Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
   - Ù†Ù…Ø§ÛŒØ´ spinner Ùˆ disable Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ù‡Ù†Ú¯Ø§Ù… submit

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- ØªÙ…Ø§Ù… ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø°Ú©Ø± Ø´Ø¯Ù‡
- `messages/fa.json`, `messages/en.json`, `messages/ar.json`
- `src/components/admin/settings/SettingsTab.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† locale prop
- `src/components/admin/content/ContentTabs.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† locale prop
- `src/components/admin/content/CategoriesTab.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† locale prop
- `src/components/admin/content/ArticlesTab.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† locale prop
- `src/components/admin/education/EducationTab.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† locale prop
- `src/components/admin/education/EducationCategoryTab.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† locale prop

---

## Ù…Ø´Ú©Ù„Ø§Øª Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡ Ùˆ Ø±ÙØ¹ Ø´Ø¯Ù‡

### âœ… Ù…Ø´Ú©Ù„ 1: Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¯Ø± Ø¢ÛŒÚ©ÙˆÙ† Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯

**Ù…Ø´Ú©Ù„:**
- Ø¢ÛŒÚ©ÙˆÙ† Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¯Ø± Ù‡Ø¯Ø± ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÛŒâ€ŒØ¯Ø§Ø¯

**Ø¹Ù„Øª:**
- `totalItems` Ø¯Ø± `CartContext` Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† getter ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ Ú©Ù‡ Ø¯Ø± Zustand reactive Ù†ÛŒØ³Øª

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
- Ø­Ø°Ù getter Ø§Ø² interface
- Ù…Ø­Ø§Ø³Ø¨Ù‡ `totalItems` Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§:
  ```typescript
  const totalItems = items.reduce((total, item) => total + item.quantity, 0);
  ```

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/contexts/CartContext.tsx` - Ø­Ø°Ù getters
- `src/components/layout/Header.tsx` - Ù…Ø­Ø§Ø³Ø¨Ù‡ totalItems Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª
- `src/components/ecommerce/MiniCart.tsx` - Ù…Ø­Ø§Ø³Ø¨Ù‡ totalItems Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª

---

### âœ… Ù…Ø´Ú©Ù„ 2: Ù†Ù…Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª 0 Ø¯Ø± Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´ ØµÙØ­Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯

**Ù…Ø´Ú©Ù„:**
- Ø¯Ø± ØµÙØ­Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ (`/fa/cart`)ØŒ Ø¨Ø®Ø´ "Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´" Ù‚ÛŒÙ…Øª 0 Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ø§Ø¯

**Ø¹Ù„Øª:**
- `totalPrice` Ø¯Ø± `CartContext` Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† getter ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ Ú©Ù‡ reactive Ù†ÛŒØ³Øª

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
- Ø­Ø°Ù getter Ø§Ø² interface
- Ù…Ø­Ø§Ø³Ø¨Ù‡ `totalPrice` Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª:
  ```typescript
  const totalPrice = items.reduce((total, item) => total + (item.price * item.quantity), 0);
  ```

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/contexts/CartContext.tsx` - Ø­Ø°Ù getters
- `src/app/[locale]/cart/CartPageClient.tsx` - Ù…Ø­Ø§Ø³Ø¨Ù‡ totalPrice Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª
- `src/app/[locale]/checkout/CheckoutPageClient.tsx` - Ù…Ø­Ø§Ø³Ø¨Ù‡ totalPrice Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª

---

### âœ… Ù…Ø´Ú©Ù„ 3: Ø®Ø·Ø§ÛŒ 500 Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ§Ø±Ø´

**Ù…Ø´Ú©Ù„:**
- Ù‡Ù†Ú¯Ø§Ù… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ØŒ Ø®Ø·Ø§ÛŒ `Failed to create order` Ø¨Ø§ Ú©Ø¯ 500 Ø±Ø® Ù…ÛŒâ€ŒØ¯Ø§Ø¯

**Ø¹Ù„Ù„ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ:**
1. ØªØ¨Ø¯ÛŒÙ„ Ù†ÙˆØ¹ Ù‚ÛŒÙ…Øª (Decimal vs Number)
2. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø­ØµÙˆÙ„ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
3. Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ

**Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡:**

1. **Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§:**
   - Ø§ÙØ²ÙˆØ¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø§ÛŒ debugging
   - Ø§ÙØ²ÙˆØ¯Ù† validation Ø¨Ø±Ø§ÛŒ item data
   - Ø¨Ù‡Ø¨ÙˆØ¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§

2. **Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ù…Ø­ØµÙˆÙ„:**
   - Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ù…Ø­ØµÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒ
   - Ø§Ø¯Ø§Ù…Ù‡ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø­ØªÛŒ Ø§Ú¯Ø± Ù…Ø­ØµÙˆÙ„ Ù¾ÛŒØ¯Ø§ Ù†Ø´ÙˆØ¯ (Ø¨Ø§ warning)

3. **ØªØ¨Ø¯ÛŒÙ„ Ù†ÙˆØ¹ Ù‚ÛŒÙ…Øª:**
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `Number()` Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§
   - Prisma Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

4. **Ø¨Ù‡Ø¨ÙˆØ¯ Ø³Ø§Ø®ØªØ§Ø± Ú©Ø¯:**
   - Ø§ØµÙ„Ø§Ø­ indentation Ùˆ Ø³Ø§Ø®ØªØ§Ø± Ú©Ø¯
   - Ø§ÙØ²ÙˆØ¯Ù† null check Ø¨Ø±Ø§ÛŒ order

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/orders/route.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ error handling Ùˆ validation

---

## ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± CartContext

### Ù‚Ø¨Ù„:
```typescript
interface CartState {
  // ...
  totalItems: number;  // Getter
  totalPrice: number;  // Getter
  itemCount: number;   // Getter
}

get totalItems() {
  return get().items.reduce((total, item) => total + item.quantity, 0);
}
```

### Ø¨Ø¹Ø¯:
```typescript
interface CartState {
  items: CartItem[];
  isOpen: boolean;
  // ... actions only
  // Getters removed
}

// Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§:
const totalItems = items.reduce((total, item) => total + item.quantity, 0);
const totalPrice = items.reduce((total, item) => total + (item.price * item.quantity), 0);
```

---

## ØªØ³Øª Ùˆ Ø¨Ø±Ø±Ø³ÛŒ

### Ú†Ú©â€ŒÙ„ÛŒØ³Øª ØªØ³Øª:

- [x] Ø¢ÛŒÚ©ÙˆÙ† Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ ØªØ¹Ø¯Ø§Ø¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- [x] ØµÙØ­Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ù‚ÛŒÙ…Øª Ú©Ù„ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- [x] Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´ Ø¯Ø± ØµÙØ­Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø±Ø³Øª Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- [x] Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ Ø¨Ø¯ÙˆÙ† Ø®Ø·Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯
- [x] Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ debugging Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù‡Ø³ØªÙ†Ø¯

---

## Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. **Reactivity Ø¯Ø± Zustand:**
   - Getters Ø¯Ø± Zustand reactive Ù†ÛŒØ³ØªÙ†Ø¯
   - Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± computedØŒ Ø¨Ø§ÛŒØ¯ Ø§Ø² selectors Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯ ÛŒØ§ Ø¯Ø± Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ø±Ø¯

2. **Type Safety:**
   - Prisma Decimal types Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² JavaScript numbers ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
   - Ø§Ù…Ø§ Ø¨Ù‡ØªØ± Ø§Ø³Øª Ø§Ø² `Number()` Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯

3. **Error Handling:**
   - Ù‡Ù…ÛŒØ´Ù‡ validation Ø±Ø§ Ø¯Ø± API Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯
   - Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ debugging Ø¶Ø±ÙˆØ±ÛŒ Ù‡Ø³ØªÙ†Ø¯

---

## ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡

1. `src/contexts/CartContext.tsx` - Ø­Ø°Ù getters
2. `src/components/layout/Header.tsx` - Ù…Ø­Ø§Ø³Ø¨Ù‡ totalItems
3. `src/components/ecommerce/MiniCart.tsx` - Ù…Ø­Ø§Ø³Ø¨Ù‡ totalItems Ùˆ totalPrice
4. `src/app/[locale]/cart/CartPageClient.tsx` - Ù…Ø­Ø§Ø³Ø¨Ù‡ totalItems Ùˆ totalPrice
5. `src/app/[locale]/checkout/CheckoutPageClient.tsx` - Ù…Ø­Ø§Ø³Ø¨Ù‡ totalPrice
6. `src/app/api/customer/orders/route.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ error handling

---

---

## âœ… Ù…Ø´Ú©Ù„ 4: Ø®Ø·Ø§ÛŒ useCustomer Ø¯Ø± CheckoutAddressSelector

**Ù…Ø´Ú©Ù„:**
- Ø®Ø·Ø§ÛŒ `useCustomer must be used within a CustomerProvider` Ø¯Ø± ØµÙØ­Ù‡ checkout

**Ø¹Ù„Øª:**
- Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øª `CheckoutAddressSelector` Ø§Ø² hook `useCustomer()` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- Ø§Ù…Ø§ ØµÙØ­Ù‡ checkout Ø¨Ø§ `CustomerProvider` wrap Ù†Ø´Ø¯Ù‡ Ø¨ÙˆØ¯

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
- Ø§ÙØ²ÙˆØ¯Ù† `CustomerProvider` Ø¨Ù‡ ØµÙØ­Ù‡ checkout

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/[locale]/checkout/page.tsx` - Ø§ÙØ²ÙˆØ¯Ù† CustomerProvider wrapper

---

## âœ… Ù…Ø´Ú©Ù„ 5: Ø®Ø·Ø§ÛŒ Foreign Key Constraint Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³

**Ù…Ø´Ú©Ù„:**
- Ø®Ø·Ø§ÛŒ `Foreign key constraint violated on the constraint: addresses_userId_fkey` Ù‡Ù†Ú¯Ø§Ù… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´
- Ø®Ø·Ø§ÛŒ `User not found` Ø¯Ø± API `/api/customer/profile`

**Ø¹Ù„Øª:**
- Ú©Ø§Ø±Ø¨Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± session Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- Ù‡Ù†Ú¯Ø§Ù… Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¨Ø§ `userId: session.user.id`ØŒ foreign key constraint Ù†Ù‚Ø¶ Ù…ÛŒâ€ŒØ´Ø¯

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³:**
   - Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³
   - Ø¨Ø±Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ
   - Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø®Ø·Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯

2. **Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§:**
   - Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ÛŒ Prisma (P2003 Ø¨Ø±Ø§ÛŒ foreign key, P2002 Ø¨Ø±Ø§ÛŒ unique constraint)
   - Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/orders/route.ts` - Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ error handling

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Verify user exists in database before creating addresses
const userExists = await prisma.user.findUnique({
  where: { id: session.user.id },
  select: { id: true, email: true, isActive: true }
});

if (!userExists) {
  return NextResponse.json(
    { 
      success: false, 
      error: "User account not found. Please log out and log in again." 
    },
    { status: 404 }
  );
}

if (!userExists.isActive) {
  return NextResponse.json(
    { 
      success: false, 
      error: "Your account has been deactivated. Please contact support." 
    },
    { status: 403 }
  );
}
```

---

## âœ… Ù…Ø´Ú©Ù„ 6: Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ÛŒ "User account not found"

**Ù…Ø´Ú©Ù„:**
- ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± session ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù†ÛŒØ³ØªØŒ Ø®Ø·Ø§ÛŒ 404 Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯
- Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø¶Ø­ Ù†Ø¨ÙˆØ¯

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ø¯Ø± Ú©Ù„Ø§ÛŒÙ†Øª:**
   - ØªØ´Ø®ÛŒØµ Ø®Ø·Ø§ÛŒ "User account not found"
   - Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ÙˆØ§Ø¶Ø­â€ŒØªØ± Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
   - Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ logout Ùˆ login Ù…Ø¬Ø¯Ø¯

2. **Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ ØªØ±Ø¬Ù…Ù‡:**
   - Ø§ÙØ²ÙˆØ¯Ù† `userAccountNotFound` Ø¨Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ (fa, en, ar)
   - Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ TypeScript interface

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/[locale]/checkout/CheckoutPageClient.tsx` - Ø¨Ù‡Ø¨ÙˆØ¯ error handling
- `messages/fa.json`, `messages/en.json`, `messages/ar.json` - Ø§ÙØ²ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ ØªØ±Ø¬Ù…Ù‡
- `src/lib/i18n.ts` - Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ interface

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Handle user not found error - redirect to logout
if (response.status === 404 && result.error?.includes('User account not found')) {
  const shouldLogout = window.confirm(
    String(t.userAccountNotFound || 'Your account was not found. Please log out and log in again. Would you like to log out now?')
  );
  if (shouldLogout) {
    signOut({ callbackUrl: `/${locale}/auth/login` });
    return;
  }
  throw new Error(result.error || 'Failed to create order');
}
```

---

## âœ… Ù…Ø´Ú©Ù„ 7: Ù‡Ø¯Ø§ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ØºÛŒØ±Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø´Ø¯Ù‡ Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯/Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…

**Ù…Ø´Ú©Ù„:**
- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø¯ÙˆÙ† Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø³ØªÙ†Ø¯ Ø¨Ù‡ ØµÙØ­Ù‡ checkout Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯
- Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯ ÛŒØ§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…ØŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ù‡Ø¯Ø§ÛŒØª Ù…ÛŒâ€ŒØ´Ø¯ Ù†Ù‡ checkout

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø¯Ø± CheckoutPageClient:**
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `useSession` Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
   - Ù‡Ø¯Ø§ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ ØµÙØ­Ù‡ login Ø¨Ø§ `callbackUrl` Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
   - Ù†Ù…Ø§ÛŒØ´ loading state Ø¯Ø± Ø­ÛŒÙ† Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

2. **Ø¨Ù‡Ø¨ÙˆØ¯ ØµÙØ­Ù‡ Login:**
   - Ø®ÙˆØ§Ù†Ø¯Ù† `callbackUrl` Ø§Ø² query parameters
   - Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ `callbackUrl` Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ (Ø¨Ù‡ Ø¬Ø§ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ)
   - Ø§Ù†ØªÙ‚Ø§Ù„ `callbackUrl` Ø¨Ù‡ ØµÙØ­Ù‡ register

3. **Ø¨Ù‡Ø¨ÙˆØ¯ ØµÙØ­Ù‡ Register:**
   - Ø®ÙˆØ§Ù†Ø¯Ù† `callbackUrl` Ø§Ø² query parameters
   - Ù‡Ø¯Ø§ÛŒØª Ø¨Ù‡ login Ø¨Ø§ `callbackUrl` Ø¨Ø¹Ø¯ Ø§Ø² Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚
   - Ø­ÙØ¸ `callbackUrl` Ø¯Ø± ØªÙ…Ø§Ù… Ù…Ø±Ø§Ø­Ù„ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/[locale]/checkout/CheckoutPageClient.tsx` - Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
- `src/app/[locale]/auth/login/page.tsx` - Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² callbackUrl
- `src/app/[locale]/auth/register/page.tsx` - Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² callbackUrl

**Ø¬Ø±ÛŒØ§Ù† Ú©Ø§Ø±:**
1. Ú©Ø§Ø±Ø¨Ø± Ø¨Ø¯ÙˆÙ† Ø­Ø³Ø§Ø¨ Ø¨Ù‡ `/checkout` Ù…ÛŒâ€ŒØ±ÙˆØ¯
2. Ø³ÛŒØ³ØªÙ… Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª
3. Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ `/auth/login?callbackUrl=/checkout` Ù‡Ø¯Ø§ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯
4. Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆØ¯ ÛŒØ§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†Ø¯
5. Ø¨Ø¹Ø¯ Ø§Ø² ÙˆØ±ÙˆØ¯/Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚ØŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ `/checkout` Ø¨Ø§Ø²Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯
6. Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø­ÙØ¸ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Zustand state)

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Check authentication status and redirect if not authenticated
useEffect(() => {
  if (status === "loading") return; // Wait for session to load
  
  if (status === "unauthenticated") {
    // Redirect to login with callback URL to return to checkout
    const callbackUrl = encodeURIComponent(`/${locale}/checkout`);
    router.push(`/${locale}/auth/login?callbackUrl=${callbackUrl}`);
  }
}, [status, router, locale]);
```

---

---

## âœ… Ù…Ø´Ú©Ù„ 8: Ø±ÙØ¹ Ù…Ø´Ú©Ù„ Ø§Ø±Ø³Ø§Ù„ SMS Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†

**Ù…Ø´Ú©Ù„:**
- SMS ØªØ£ÛŒÛŒØ¯ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´Ø¯
- Ø®Ø·Ø§Ù‡Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ù…ÛŒâ€ŒØ´Ø¯Ù†Ø¯

**Ø¹Ù„Øª:**
- ØªØ§Ø¨Ø¹ `sendVerificationCode` ÛŒÚ© Promise Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯ Ú©Ù‡ resolve Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ø®Ø·Ø§ throw Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯)
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `try-catch` Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ø§ÙÛŒ Ù†Ø¨ÙˆØ¯
- Ø¨Ø§ÛŒØ¯ `result.success` Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒØ´Ø¯ Ù†Ù‡ catch Ú©Ø±Ø¯Ù† Ø®Ø·Ø§

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ø¯Ø± API:**
   - Ø¨Ø±Ø±Ø³ÛŒ `result.success` Ø¨Ù‡ Ø¬Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² try-catch
   - Ø§ÙØ²ÙˆØ¯Ù† fallback Ø¨Ù‡ simple SMS Ø§Ú¯Ø± template SMS Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ø¯
   - Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ `KAVENEGAR_API_KEY` Ø¯Ø± environment variables
   - Ø¨Ù‡Ø¨ÙˆØ¯ logging Ø¨Ø±Ø§ÛŒ debugging

2. **Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ø¯Ø± Ú©Ù„Ø§ÛŒÙ†Øª:**
   - Ù†Ù…Ø§ÛŒØ´ warning Ø§Ú¯Ø± SMS Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ Ø§Ù…Ø§ Ú©Ø¯ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
   - Ø§Ù…Ú©Ø§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬Ø¯Ø¯ Ú©Ø¯ Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… Ø¯Ø±ÛŒØ§ÙØª

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/auth/verify-phone/send/route.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ error handling Ùˆ fallback
- `src/app/[locale]/auth/register/page.tsx` - Ø¨Ù‡Ø¨ÙˆØ¯ Ù†Ù…Ø§ÛŒØ´ warning

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…:**
1. **Environment Variables:**
   - Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯ Ú©Ù‡ `KAVENEGAR_API_KEY` Ø¯Ø± `.env.local` ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª

2. **Template Ø¯Ø± Kavehnegar:**
   - Ø§Ú¯Ø± template `verify` Ø¯Ø± Ù¾Ù†Ù„ Kavehnegar ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ØŒ Ø³ÛŒØ³ØªÙ… Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² simple SMS Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯

3. **Fallback Strategy:**
   - Ø§Ú¯Ø± Ù‡Ø± Ø¯Ùˆ Ø±ÙˆØ´ (template Ùˆ simple SMS) Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ù†Ø¯ØŒ Ú©Ø¯ Ù‡Ù…Ú†Ù†Ø§Ù† Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù†Ø¯

---

## âœ… Ù…Ø´Ú©Ù„ 9: Ø±ÙØ¹ Ø®Ø·Ø§ÛŒ Prisma Validation Ø¯Ø± Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´

**Ù…Ø´Ú©Ù„:**
- Ø®Ø·Ø§ÛŒ `Invalid data provided. Please check your order details.` Ø¨Ø§ Ú©Ø¯ 400 Ù‡Ù†Ú¯Ø§Ù… Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´
- Ø®Ø·Ø§ÛŒ Prisma validation Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Decimal

**Ø¹Ù„Øª:**
- ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Decimal Ø¯Ø± Prisma Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ¨Ø¯ÛŒÙ„ ØµØ±ÛŒØ­ Ø¨Ù‡ `Decimal` Ø¯Ø§Ø±Ù†Ø¯
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `Number()` Ø¨Ù‡ Ø¬Ø§ÛŒ `new Decimal()` Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù‚ÛŒÙ…Øª
- Ø¹Ø¯Ù… Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ `customerEmail` Ø¯Ø± session

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **ØªØ¨Ø¯ÛŒÙ„ ØµØ­ÛŒØ­ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Decimal:**
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `new Decimal()` Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù‚ÛŒÙ…Øª (subtotal, taxAmount, shippingAmount, discountAmount, totalAmount)
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `new Decimal()` Ø¨Ø±Ø§ÛŒ unitPrice Ùˆ totalPrice Ø¯Ø± order items
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `mul()` Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ totalPrice Ø¯Ø± order items

2. **Ø¨Ø±Ø±Ø³ÛŒ customerEmail:**
   - Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ `customerEmail` Ø¯Ø± session Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ§Ø±Ø´
   - throw Ú©Ø±Ø¯Ù† Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­ Ø§Ú¯Ø± email ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯

3. **Ø¨Ù‡Ø¨ÙˆØ¯ error logging:**
   - Ø§ÙØ²ÙˆØ¯Ù† logging Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Prisma validation errors
   - Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø·Ø§ Ø¯Ø± development mode

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/orders/route.ts` - ØªØ¨Ø¯ÛŒÙ„ ØµØ­ÛŒØ­ Decimal Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ validation

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
import { Decimal } from "@prisma/client/runtime/library";

// Validate and convert Decimal values
const subtotalDecimal = new Decimal(subtotal || 0);
const taxAmountDecimal = new Decimal(taxAmount || 0);
const shippingAmountDecimal = new Decimal(shippingAmount || 0);
const discountAmountDecimal = new Decimal(discountAmount || 0);
const totalAmountDecimal = new Decimal(totalAmount || 0);

// Validate customer email (required field)
if (!session.user.email) {
  throw new Error("User email is required but not found in session");
}

// For order items:
const unitPrice = new Decimal(item.price || 0);
const itemQuantity = parseInt(String(item.quantity || 1));
const totalPrice = unitPrice.mul(itemQuantity);
```

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…:**
1. **Decimal Type:**
   - Prisma Ø§Ø² `Decimal` type Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù…Ø§Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
   - Ø¨Ø§ÛŒØ¯ Ø§Ø² `new Decimal()` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯ Ù†Ù‡ `Number()`

2. **Email Validation:**
   - `customerEmail` ÛŒÚ© ÙÛŒÙ„Ø¯ required Ø¯Ø± schema Ø§Ø³Øª
   - Ø¨Ø§ÛŒØ¯ Ø¯Ø± session Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯

---

## âœ… Ù…Ø´Ú©Ù„ 10: Ø±ÙØ¹ Ø®Ø·Ø§ÛŒ Enum Case Sensitivity Ø¯Ø± Shipping Method

**Ù…Ø´Ú©Ù„:**
- Ø®Ø·Ø§ÛŒ `Invalid data provided` Ø¨Ø§ Ú©Ø¯ 400 Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø§Ø´Øª
- `shippingMethod` Ø¨Ù‡ ØµÙˆØ±Øª lowercase (`"post"`) Ø§Ø² Ú©Ù„Ø§ÛŒÙ†Øª Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´Ø¯
- Prisma enum Ù‡Ø§ case-sensitive Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ uppercase Ø¯Ø§Ø±Ù†Ø¯ (`"POST"`)

**Ø¹Ù„Øª:**
- Ú©Ù„Ø§ÛŒÙ†Øª `shippingMethod: "post"` (lowercase) Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ø±Ø¯
- Prisma enum `ShippingMethod` Ù…Ù‚Ø§Ø¯ÛŒØ± `POST`, `TIPAX`, `EXPRESS` Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ø¯ (uppercase)
- Ø¹Ø¯Ù… ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ uppercase Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Prisma

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Normalize enum values:**
   - ØªØ¨Ø¯ÛŒÙ„ `shippingMethod` Ùˆ `paymentMethod` Ø¨Ù‡ uppercase Ù‚Ø¨Ù„ Ø§Ø² validation
   - Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± enum values Ø¨Ø¹Ø¯ Ø§Ø² normalization
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² normalized values Ø¯Ø± order creation

2. **Ø¨Ù‡Ø¨ÙˆØ¯ validation:**
   - Ø§ÙØ²ÙˆØ¯Ù† validation Ø¨Ø±Ø§ÛŒ enum values
   - Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­â€ŒØªØ±

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/orders/route.ts` - Ø§ÙØ²ÙˆØ¯Ù† normalization Ùˆ validation Ø¨Ø±Ø§ÛŒ enum values

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Normalize enum values to uppercase (Prisma enums are case-sensitive)
const normalizedShippingMethod = shippingMethod.toUpperCase();
const normalizedPaymentMethod = paymentMethod.toUpperCase();

// Validate enum values
const validPaymentMethods = ['ZARINPAL', 'BANK_TRANSFER', 'CASH_ON_DELIVERY'];
const validShippingMethods = ['POST', 'TIPAX', 'EXPRESS'];

if (!validPaymentMethods.includes(normalizedPaymentMethod)) {
  return NextResponse.json(
    { 
      success: false, 
      error: `Invalid payment method: ${paymentMethod}. Must be one of: ${validPaymentMethods.join(', ')}` 
    },
    { status: 400 }
  );
}

if (!validShippingMethods.includes(normalizedShippingMethod)) {
  return NextResponse.json(
    { 
      success: false, 
      error: `Invalid shipping method: ${shippingMethod}. Must be one of: ${validShippingMethods.join(', ')}` 
    },
    { status: 400 }
  );
}

// Use normalized values in order creation
paymentMethod: normalizedPaymentMethod as "ZARINPAL" | "BANK_TRANSFER" | "CASH_ON_DELIVERY",
shippingMethod: normalizedShippingMethod as "POST" | "TIPAX" | "EXPRESS",
```

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…:**
1. **Enum Case Sensitivity:**
   - Prisma enums case-sensitive Ù‡Ø³ØªÙ†Ø¯
   - Ø¨Ø§ÛŒØ¯ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒÙ… Ú©Ù‡ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨Ø§ enum definition Ù…Ø·Ø§Ø¨Ù‚Øª Ø¯Ø§Ø±Ù†Ø¯

2. **Normalization:**
   - ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ uppercase Ù‚Ø¨Ù„ Ø§Ø² validation Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡
   - Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ú©Ù„Ø§ÛŒÙ†Øª Ø¨ØªÙˆØ§Ù†Ø¯ lowercase ÛŒØ§ uppercase Ø§Ø±Ø³Ø§Ù„ Ú©Ù†Ø¯

---

## âœ… Ù…Ø´Ú©Ù„ 11: Payment Gateway Not Configured

**Ù…Ø´Ú©Ù„:**
- Ø®Ø·Ø§ÛŒ `Payment gateway is not configured` Ø¨Ø§ Ú©Ø¯ 500
- Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´Ø¯ Ø§Ù…Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Zarinpal Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯
- `PaymentSettings` Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª ÛŒØ§ `zarinpalMerchantId` Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯

**Ø¹Ù„Øª:**
- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ (`PaymentSettings`) Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡ Ø¨ÙˆØ¯
- API route ÙÙ‚Ø· Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯ Ùˆ fallback Ø¨Ù‡ environment variables Ù†Ø¯Ø§Ø´Øª
- Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ø§Ø¨ØªØ¯Ø§ Ø§Ø² Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒÚ©Ø±Ø¯

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Auto-create Payment Settings:**
   - Ø§Ú¯Ø± `PaymentSettings` ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ ÛŒÚ© Ø±Ú©ÙˆØ±Ø¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ø§Ø² environment variables Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† fallback Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯

2. **Environment Variable Fallback:**
   - Ø§Ú¯Ø± `zarinpalMerchantId` Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ØŒ Ø§Ø² `ZARINPAL_MERCHANT_ID` Ø¯Ø± environment variables Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ø¯Ø± development Ø¨ØªÙˆØ§Ù† Ø§Ø² `.env` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯

3. **Ø¨Ù‡Ø¨ÙˆØ¯ Error Messages:**
   - Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­â€ŒØªØ± Ú©Ù‡ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒÚ¯ÙˆÛŒØ¯ Ø¨Ø§ÛŒØ¯ Merchant ID Ø±Ø§ Ø¯Ø± admin settings ÛŒØ§ environment variables ØªÙ†Ø¸ÛŒÙ… Ú©Ù†Ø¯

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/payment/zarinpal/request/route.ts` - Ø§ÙØ²ÙˆØ¯Ù† auto-create Ùˆ environment variable fallback

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Get payment settings or create default if not exists
let paymentSettings = await prisma.paymentSettings.findFirst();

if (!paymentSettings) {
  // Create default payment settings if not exists
  console.log('âš ï¸ [Payment Request] Payment settings not found, creating default...');
  paymentSettings = await prisma.paymentSettings.create({
    data: {
      zarinpalMerchantId: process.env.ZARINPAL_MERCHANT_ID || "",
      zarinpalApiKey: process.env.ZARINPAL_API_KEY || "",
      zarinpalSandbox: process.env.ZARINPAL_SANDBOX === "true" || true,
      allowBankTransfer: true,
      allowCashOnDelivery: true,
    }
  });
  console.log('âœ… [Payment Request] Default payment settings created');
}

if (!paymentSettings.zarinpalMerchantId || paymentSettings.zarinpalMerchantId.trim() === "") {
  // Try to get from environment variable as fallback
  const envMerchantId = process.env.ZARINPAL_MERCHANT_ID;
  if (envMerchantId) {
    console.log('âš ï¸ [Payment Request] Using merchant ID from environment variable');
    paymentSettings.zarinpalMerchantId = envMerchantId;
  } else {
    console.error('âŒ [Payment Request] Zarinpal Merchant ID is not configured');
    return NextResponse.json(
      { 
        success: false, 
        error: "Payment gateway is not configured. Please configure Zarinpal Merchant ID in admin settings or environment variables." 
      },
      { status: 500 }
    );
  }
}
```

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…:**
1. **Environment Variables:**
   - Ø¨Ø±Ø§ÛŒ developmentØŒ `ZARINPAL_MERCHANT_ID` Ø¯Ø± `.env.local` ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª
   - Ø¨Ø±Ø§ÛŒ productionØŒ `ZARINPAL_MERCHANT_ID` Ø¯Ø± `.env.production` ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª
   - Merchant ID: `34f387ef-3ba2-41ba-85ee-c86813806726`

2. **Admin Settings:**
   - Ø¨Ø±Ø§ÛŒ productionØŒ Ø¨Ù‡ØªØ± Ø§Ø³Øª Ø§Ø² Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ† (`/admin/settings`) ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯
   - Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ø´ÙˆØ¯

3. **Auto-creation:**
   - Ø§Ú¯Ø± `PaymentSettings` ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´ØªØŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ø¯Ø± Ø§ÙˆÙ„ÛŒÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ØŒ Ø®Ø·Ø§ÛŒ "not configured" Ø±Ø® Ù†Ø¯Ù‡Ø¯

---

## âœ… Ù…Ø´Ú©Ù„ 12: Zarinpal Payment Request Error 422

**Ù…Ø´Ú©Ù„:**
- Ø®Ø·Ø§ÛŒ `Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª (Ú©Ø¯: 422)` Ø§Ø² Zarinpal API
- Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´Ø¯ Ø§Ù…Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Zarinpal Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯
- Ú©Ø¯ 422 Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ù‡ Ù…Ø¹Ù†Ø§ÛŒ validation error Ø§Ø² Ø·Ø±Ù Zarinpal Ø§Ø³Øª

**Ø¹Ù„Øª:**
- Ø¹Ø¯Ù… validation Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Zarinpal
- Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…Ø¨Ù„ØºØŒ callback URLØŒ mobileØŒ email ÛŒØ§ merchant ID Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯
- Ø¹Ø¯Ù… logging Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ debugging

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Validation Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„:**
   - Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¨Ù„Øº Ø­Ø¯Ø§Ù‚Ù„ (1000 Toman = 10,000 Rial)
   - Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² integer Ø¨ÙˆØ¯Ù† Ù…Ø¨Ù„Øº
   - Ø¨Ø±Ø±Ø³ÛŒ Ø·ÙˆÙ„ description (Ø­Ø¯Ø§Ú©Ø«Ø± 255 Ú©Ø§Ø±Ø§Ú©ØªØ±)
   - Validation ÙØ±Ù…Øª callback URL
   - Validation ÙØ±Ù…Øª mobile (Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§ÛŒØ±Ø§Ù†ÛŒ)
   - Validation ÙØ±Ù…Øª email

2. **Ø¨Ù‡Ø¨ÙˆØ¯ Logging:**
   - Log Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø¨Ù‡ Zarinpal
   - Log Ú©Ø±Ø¯Ù† Ú©Ø§Ù…Ù„ response Ø§Ø² Zarinpal
   - Log Ú©Ø±Ø¯Ù† validation errors Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª

3. **Error Handling Ø¨Ù‡ØªØ±:**
   - Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­â€ŒØªØ±
   - Ù†Ù…Ø§ÛŒØ´ validation errors Ø§Ø² Zarinpal

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/payment/zarinpal/request/route.ts` - Ø§ÙØ²ÙˆØ¯Ù† validation Ùˆ logging
- `src/lib/zarinpal.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ validation Ùˆ error handling

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Validation amount
if (amountInTomans < 1000) {
  return NextResponse.json(
    { 
      success: false, 
      error: `Ù…Ø¨Ù„Øº Ø³ÙØ§Ø±Ø´ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û±Û°,Û°Û°Û° Ø±ÛŒØ§Ù„ Ø¨Ø§Ø´Ø¯. Ù…Ø¨Ù„Øº ÙØ¹Ù„ÛŒ: ${Number(order.totalAmount).toLocaleString('fa-IR')} Ø±ÛŒØ§Ù„` 
    },
    { status: 400 }
  );
}

// Ensure amount is integer
const amountInteger = Math.floor(amountInTomans);

// Validate description length
if (description.length > 255) {
  return NextResponse.json(
    { 
      success: false, 
      error: "ØªÙˆØ¶ÛŒØ­Ø§Øª Ø³ÙØ§Ø±Ø´ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø§Ø³Øª" 
    },
    { status: 400 }
  );
}

// Validate and format mobile
let mobileFormatted: string | undefined = undefined;
if (order.user.phone) {
  const phoneDigits = order.user.phone.replace(/\D/g, '');
  if (phoneDigits.length === 11 && phoneDigits.startsWith('09')) {
    mobileFormatted = phoneDigits;
  } else if (phoneDigits.length === 10 && phoneDigits.startsWith('9')) {
    mobileFormatted = `0${phoneDigits}`;
  }
}

// Validate email format
let emailFormatted: string | undefined = undefined;
if (order.user.email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (emailRegex.test(order.user.email)) {
    emailFormatted = order.user.email;
  }
}
```

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…:**
1. **Merchant ID Validation:**
   - Zarinpal Merchant ID Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 36 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯
   - Ø¨Ø±Ø§ÛŒ SandboxØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Merchant ID ØªØ³Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
   - Merchant ID Ø¨Ø§ÛŒØ¯ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø¯Ù…ÛŒÙ† ÛŒØ§ Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…Ø­ÛŒØ·ÛŒ (`ZARINPAL_MERCHANT_ID`) ØªÙ†Ø¸ÛŒÙ… Ø´ÙˆØ¯
   - Ø§Ú¯Ø± Merchant ID Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ØŒ Ø®Ø·Ø§ÛŒ 422 Ø¨Ø§ Ù¾ÛŒØ§Ù… "The merchant id must be at least 36 characters" Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒØ´ÙˆØ¯

2. **Minimum Amount:**
   - Zarinpal Ø­Ø¯Ø§Ù‚Ù„ 1000 Toman (10,000 Rial) Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ø¯
   - Ø¨Ø§ÛŒØ¯ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆØ¯

3. **Amount Format:**
   - Ù…Ø¨Ù„Øº Ø¨Ø§ÛŒØ¯ integer Ø¨Ø§Ø´Ø¯ (Ù†Ù‡ decimal)
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `Math.floor()` Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†

4. **Mobile Format:**
   - Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ ÙØ±Ù…Øª `09xxxxxxxxx` Ø¨Ø§Ø´Ø¯
   - Ø§Ú¯Ø± `9xxxxxxxxx` Ø¨ÙˆØ¯ØŒ `0` Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯

5. **Email Format:**
   - Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ù…Øª email Ø¨Ø§ regex
   - Ø§Ú¯Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯ØŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

6. **Callback URL:**
   - Ø¨Ø§ÛŒØ¯ ÛŒÚ© URL Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯
   - Ø¯Ø± production Ø¨Ø§ÛŒØ¯ HTTPS Ø¨Ø§Ø´Ø¯

**Ø±Ø§Ù‡â€ŒØ­Ù„ Ø¨Ø±Ø§ÛŒ Merchant ID:**
1. **Ø¨Ø±Ø§ÛŒ Sandbox (ØªØ³Øª):**
   - Merchant ID Ø¯Ø± `.env.local` ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª: `34f387ef-3ba2-41ba-85ee-c86813806726`
   - `ZARINPAL_SANDBOX=true` Ø¨Ø±Ø§ÛŒ ØªØ³Øª ÙØ¹Ø§Ù„ Ø§Ø³Øª
   - ÛŒØ§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø± Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯

2. **Ø¨Ø±Ø§ÛŒ Production:**
   - Merchant ID Ø¯Ø± `.env.production` ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª: `34f387ef-3ba2-41ba-85ee-c86813806726`
   - `ZARINPAL_SANDBOX=false` Ø¨Ø±Ø§ÛŒ production ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª

**Ù†Ú©ØªÙ‡:** Merchant ID Ø¯Ø± Ù‡Ø± Ø¯Ùˆ Ù…Ø­ÛŒØ· (local Ùˆ production) ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª Ùˆ Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ… Ø¯Ø³ØªÛŒ Ù†ÛŒØ³Øª.

---

## âœ… Ù…Ø´Ú©Ù„ 13: Checkout Success Page Not Showing Order Details

**Ù…Ø´Ú©Ù„:**
- ØµÙØ­Ù‡ success Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª ÙÙ‚Ø· Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ø§Ø¯
- Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´ØŒ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®ØªØŒ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ùˆ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø³ÙØ§Ø±Ø´ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´Ø¯
- ØµÙØ­Ù‡ ÙÙ‚Ø· order numberØŒ date Ùˆ refId Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ø§Ø¯

**Ø¹Ù„Øª:**
- ØµÙØ­Ù‡ success Ø§Ø² API Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒÚ©Ø±Ø¯
- ÙÙ‚Ø· Ø§Ø² URL parameters (orderNumber Ùˆ refId) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ø±Ø¯
- API endpoint ÙÙ‚Ø· order ID Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÙØªØŒ Ù†Ù‡ orderNumber

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Ø¨Ù‡Ø¨ÙˆØ¯ API Endpoint:**
   - API endpoint `/api/customer/orders/[id]` Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø±Ø¯ÛŒÙ… ØªØ§ Ù‡Ù… order ID Ùˆ Ù‡Ù… orderNumber Ø±Ø§ Ø¨Ù¾Ø°ÛŒØ±Ø¯
   - Ø§Ú¯Ø± `id` Ø¨Ø§ "HS6-" Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯ØŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† orderNumber Ø¯Ø± Ù†Ø¸Ø± Ú¯Ø±ÙØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±ØªØŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† order ID (UUID) Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯

2. **Ø¨Ù‡Ø¨ÙˆØ¯ ØµÙØ­Ù‡ Success:**
   - Ø§ÙØ²ÙˆØ¯Ù† fetch order details Ø§Ø² API ÙˆÙ‚ØªÛŒ orderNumber Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª
   - Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´ Ø¨Ø§ ØªØµØ§ÙˆÛŒØ±
   - Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ù†Ø§Ø³Ø¨
   - Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ùˆ ØµÙˆØ±ØªØ­Ø³Ø§Ø¨
   - Ù†Ù…Ø§ÛŒØ´ breakdown Ú©Ø§Ù…Ù„ Ù‚ÛŒÙ…Øª (subtotal, discount, shipping, tax, total)
   - Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒÙ†Ú© Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´

3. **UI/UX Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡:**
   - Layout Ø¨Ù‡ØªØ± Ø¨Ø§ grid system
   - Ù†Ù…Ø§ÛŒØ´ ØªØµØ§ÙˆÛŒØ± Ù…Ø­ØµÙˆÙ„Ø§Øª
   - Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª (Paid = green, Pending = yellow, Failed = red)
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² utility functions Ø¨Ø±Ø§ÛŒ format Ú©Ø±Ø¯Ù† Ù‚ÛŒÙ…Øª Ùˆ ØªØ§Ø±ÛŒØ®

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/orders/[id]/route.ts` - Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² orderNumber
- `src/app/[locale]/checkout/success/page.tsx` - Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// API Endpoint - Support both order ID and orderNumber
const isOrderNumber = id.startsWith("HS6-");
const whereClause = isOrderNumber
  ? { orderNumber: id, userId: session.user.id }
  : { id: id, userId: session.user.id };

// Success Page - Fetch order details
useEffect(() => {
  const fetchOrder = async () => {
    if (!orderNumber || !session?.user?.id) return;
    
    const response = await fetch(`/api/customer/orders/${orderNumber}`);
    const result = await response.json();
    
    if (result.success && result.data) {
      setOrder(result.data);
    }
  };
  
  if (orderNumber && session?.user?.id) {
    fetchOrder();
  }
}, [orderNumber, session?.user?.id]);
```

**ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯:**
1. **Order Items Display:**
   - Ù†Ù…Ø§ÛŒØ´ ØªÙ…Ø§Ù… Ù…Ø­ØµÙˆÙ„Ø§Øª Ø³ÙØ§Ø±Ø´ Ø¨Ø§ ØªØµØ§ÙˆÛŒØ±
   - Ù†Ù…Ø§ÛŒØ´ variant (Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯)
   - Ù†Ù…Ø§ÛŒØ´ quantity Ùˆ total price Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø­ØµÙˆÙ„

2. **Payment Status:**
   - Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ
   - Ù†Ù…Ø§ÛŒØ´ payment reference ID (refId)

3. **Address Display:**
   - Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„
   - Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ù…Ù„ Ø¢Ø¯Ø±Ø³ ØµÙˆØ±ØªØ­Ø³Ø§Ø¨

4. **Price Breakdown:**
   - Subtotal
   - Discount (Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯)
   - Shipping cost
   - Tax
   - Total amount

5. **Navigation:**
   - Ù„ÛŒÙ†Ú© Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø³ÙØ§Ø±Ø´
   - Ù„ÛŒÙ†Ú© Ø¨Ù‡ Ø§Ø¯Ø§Ù…Ù‡ Ø®Ø±ÛŒØ¯

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…:**
1. **Authentication:**
   - ØµÙØ­Ù‡ success Ù†ÛŒØ§Ø² Ø¨Ù‡ authentication Ø¯Ø§Ø±Ø¯
   - Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù„Ø§Ú¯ÛŒÙ† Ù†Ø¨Ø§Ø´Ø¯ØŒ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ø¯

2. **Error Handling:**
   - Ø§Ú¯Ø± Ø³ÙØ§Ø±Ø´ ÛŒØ§ÙØª Ù†Ø´ÙˆØ¯ØŒ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ù„ÛŒÙ†Ú© Ø¨Ù‡ ØµÙØ­Ù‡ Ø³ÙØ§Ø±Ø´Ø§Øª Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù… Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§

3. **Loading State:**
   - Ù†Ù…Ø§ÛŒØ´ loading state Ù‡Ù†Ú¯Ø§Ù… fetch Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
   - Ù†Ù…Ø§ÛŒØ´ skeleton ÛŒØ§ spinner

---

## âœ… Ù…Ø´Ú©Ù„ 14: Kavenegar SMS Integration and Testing

**Ù…Ø´Ú©Ù„:**
- Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ØªÙ†Ø¸ÛŒÙ… ØµØ­ÛŒØ­ Kavenegar Ø¯Ø± ØªÙ…Ø§Ù… Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§
- Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø±Ø³Ø§Ù„ SMS Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡
- Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø±Ø³Ø§Ù„ SMS Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
- Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ³Øª Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¹Ù…Ù„Ú©Ø±Ø¯ ØµØ­ÛŒØ­

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **ØªÙ†Ø¸ÛŒÙ…Ø§Øª Environment Variables:**
   - Ø§ÙØ²ÙˆØ¯Ù† `KAVENEGAR_API_KEY` Ùˆ `KAVENEGAR_SENDER` Ø¨Ù‡ `.env.production`
   - Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ØªÙ†Ø¸ÛŒÙ… ØµØ­ÛŒØ­ Ø¯Ø± `.env.local`

2. **Ø¨Ù‡Ø¨ÙˆØ¯ SMS Templates:**
   - Ø§ÙØ²ÙˆØ¯Ù† template Ø¬Ø¯ÛŒØ¯ `ORDER_PAYMENT_SUCCESS` Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
   - Ø¨Ù‡Ø¨ÙˆØ¯ template `ORDER_CONFIRMED` Ø¨Ø±Ø§ÛŒ Ø´Ø§Ù…Ù„ Ú©Ø±Ø¯Ù† Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ Ù…Ø¨Ù„Øº Ú©Ù„
   - Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª (ØªØ§ 3 Ù…Ø­ØµÙˆÙ„ØŒ ÛŒØ§ "X Ù…Ø­ØµÙˆÙ„ Ø¯ÛŒÚ¯Ø±" Ø¨Ø±Ø§ÛŒ Ø¨ÛŒØ´ØªØ±)

3. **Ø§ÙØ²ÙˆØ¯Ù† SMS Ø¯Ø± Payment Callback:**
   - Ø§Ø±Ø³Ø§Ù„ SMS Ø¨Ø¹Ø¯ Ø§Ø² Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
   - Ø´Ø§Ù…Ù„ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„Ø§ØªØŒ Ù…Ø¨Ù„Øº Ùˆ refId

4. **Ø¨Ù‡Ø¨ÙˆØ¯ SMS Ø¯Ø± Order Creation:**
   - Ø§ÙØ²ÙˆØ¯Ù† Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ù‡ SMS ØªØ§ÛŒÛŒØ¯ Ø³ÙØ§Ø±Ø´
   - Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø¨Ù„Øº Ú©Ù„ Ø¨Ù‡ SMS

5. **Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ³Øª:**
   - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ ØªØ³Øª SMS Ø¯Ø± `docs/KAVENEGAR_SMS_TESTING_GUIDE.md`
   - Ú†Ú©â€ŒÙ„ÛŒØ³Øª ØªØ³Øª
   - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ debugging

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `.env.production` - Ø§ÙØ²ÙˆØ¯Ù† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Kavenegar
- `src/lib/sms.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ templates Ùˆ Ø§ÙØ²ÙˆØ¯Ù† `ORDER_PAYMENT_SUCCESS`
- `src/app/api/customer/orders/route.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ SMS order creation Ø¨Ø§ Ù…Ø­ØµÙˆÙ„Ø§Øª
- `src/app/api/payment/zarinpal/callback/route.ts` - Ø§ÙØ²ÙˆØ¯Ù† SMS Ø¨Ø¹Ø¯ Ø§Ø² Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª
- `docs/KAVENEGAR_SMS_TESTING_GUIDE.md` - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªØ³Øª (Ø¬Ø¯ÛŒØ¯)
- `docs/SMS_IMPLEMENTATION_SUMMARY.md` - Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø³ØªÙ†Ø¯Ø§Øª

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Enhanced SMS Template
ORDER_PAYMENT_SUCCESS: (orderNumber, customerName, products, totalAmount, refId) => {
  let message = `Ø³Ù„Ø§Ù… ${customerName}ØŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø³ÙØ§Ø±Ø´ ${orderNumber} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.`;
  if (products && products.length > 0) {
    const productsList = products.length <= 3 
      ? products.join('ØŒ ') 
      : `${products.slice(0, 2).join('ØŒ ')} Ùˆ ${products.length - 2} Ù…Ø­ØµÙˆÙ„ Ø¯ÛŒÚ¯Ø±`;
    message += `\nÙ…Ø­ØµÙˆÙ„Ø§Øª: ${productsList}`;
  }
  if (totalAmount) {
    const formattedAmount = new Intl.NumberFormat('fa-IR').format(totalAmount);
    message += `\nÙ…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡: ${formattedAmount} Ø±ÛŒØ§Ù„`;
  }
  if (refId) {
    message += `\nÚ©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª: ${refId}`;
  }
  message += '\nØ³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ø³Øª.';
  return message;
}

// Payment Callback - Send SMS
if (updatedOrder.user.phone) {
  const customerName = updatedOrder.user.firstName && updatedOrder.user.lastName
    ? `${updatedOrder.user.firstName} ${updatedOrder.user.lastName}`
    : 'Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ';
  
  const products = updatedOrder.orderItems.map(item => 
    item.quantity > 1 ? `${item.name} (${item.quantity} Ø¹Ø¯Ø¯)` : item.name
  );
  const totalAmount = Number(updatedOrder.totalAmount);
  
  sendSMSSafe({
    receptor: updatedOrder.user.phone,
    message: SMSTemplates.ORDER_PAYMENT_SUCCESS(
      updatedOrder.orderNumber,
      customerName,
      products,
      totalAmount,
      verifyResult.refId
    ),
  }, `Payment success: ${updatedOrder.orderNumber}`);
}
```

**ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯:**
1. **SMS Order Confirmation:**
   - Ø´Ø§Ù…Ù„ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ
   - Ø´Ø§Ù…Ù„ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´
   - Ø´Ø§Ù…Ù„ Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª (ØªØ§ 3 Ù…Ø­ØµÙˆÙ„)
   - Ø´Ø§Ù…Ù„ Ù…Ø¨Ù„Øº Ú©Ù„

2. **SMS Payment Success:**
   - Ø´Ø§Ù…Ù„ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ
   - Ø´Ø§Ù…Ù„ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´
   - Ø´Ø§Ù…Ù„ Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª
   - Ø´Ø§Ù…Ù„ Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡
   - Ø´Ø§Ù…Ù„ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª (refId)

3. **Product List Formatting:**
   - Ù†Ù…Ø§ÛŒØ´ ØªØ§ 3 Ù…Ø­ØµÙˆÙ„ Ú©Ø§Ù…Ù„
   - Ø¨Ø±Ø§ÛŒ Ø¨ÛŒØ´ØªØ± Ø§Ø² 3 Ù…Ø­ØµÙˆÙ„: "Product 1ØŒ Product 2 Ùˆ X Ù…Ø­ØµÙˆÙ„ Ø¯ÛŒÚ¯Ø±"
   - Ù†Ù…Ø§ÛŒØ´ quantity Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª: "Product Name (3 Ø¹Ø¯Ø¯)"

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…:**
1. **Non-blocking:**
   - ØªÙ…Ø§Ù… SMS sending Ù‡Ø§ non-blocking Ù‡Ø³ØªÙ†Ø¯
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `sendSMSSafe()` Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø´Ú©Ø³ØªÙ† flow

2. **Error Handling:**
   - SMS failures Ù„Ø§Ú¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ø§Ù…Ø§ exception Ù†Ù…ÛŒâ€ŒØ§Ù†Ø¯Ø§Ø²Ù†Ø¯
   - Order Ùˆ payment flow ØªØ­Øª ØªØ£Ø«ÛŒØ± Ù‚Ø±Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯

3. **Phone Number Validation:**
   - SMS ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯ phone number Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Phone number Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ ÙØ±Ù…Øª ØµØ­ÛŒØ­ Ø¨Ø§Ø´Ø¯ (11 Ø±Ù‚Ù…ØŒ Ø´Ø±ÙˆØ¹ Ø¨Ø§ 09)

4. **Testing:**
   - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ ØªØ³Øª Ø¯Ø± `docs/KAVENEGAR_SMS_TESTING_GUIDE.md`
   - Ú†Ú©â€ŒÙ„ÛŒØ³Øª ØªØ³Øª Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¹Ù…Ù„Ú©Ø±Ø¯ ØµØ­ÛŒØ­

---

## âœ… Ù…Ø´Ú©Ù„ 15: Checkout Page Showing Empty Cart After Payment & SMS Not Sent

**Ù…Ø´Ú©Ù„:**
1. Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ØŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ `/fa/checkout` redirect Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù¾ÛŒØ§Ù… "Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª" Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
2. SMS Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
3. ØµÙØ­Ù‡ checkout Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ `/fa/checkout/success` redirect Ø´ÙˆØ¯

**Ø¹Ù„Øª:**
1. **Redirect Issue:**
   - Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®ØªØŒ cart Ø®Ø§Ù„ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² duplicate order)
   - ØµÙØ­Ù‡ checkout ÙÙ‚Ø· error parameters Ø±Ø§ Ú†Ú© Ù…ÛŒâ€ŒÚ©Ø±Ø¯ØŒ Ù†Ù‡ success parameters (orderNumber Ùˆ refId)
   - Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ `/fa/checkout` Ø¨Ø§ orderNumber Ùˆ refId Ø¨Ø±ÙˆØ¯ØŒ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ success page redirect Ø´ÙˆØ¯

2. **SMS Issue:**
   - Phone number Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø§Ø² `user.phone` Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨Ø§Ø´Ø¯
   - Ø¨Ø§ÛŒØ¯ Ø§Ø² `customerPhone` Ø¯Ø± order Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† fallback Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯
   - Logging Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ debugging ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
1. **Redirect Ø¨Ù‡ Success Page:**
   - Ø§ÙØ²ÙˆØ¯Ù† check Ø¨Ø±Ø§ÛŒ orderNumber Ùˆ refId Ø¯Ø± URL (Ø¨Ø¯ÙˆÙ† error)
   - Ø§Ú¯Ø± Ù‡Ø± Ø¯Ùˆ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ù†Ø¯ØŒ redirect Ø¨Ù‡ `/fa/checkout/success`
   - Ø§ÛŒÙ† check Ù‚Ø¨Ù„ Ø§Ø² error handling Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯

2. **Ø¨Ù‡Ø¨ÙˆØ¯ SMS Phone Number:**
   - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `customerPhone` Ø§Ø² order Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† fallback
   - Ø§Ú¯Ø± `user.phone` Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨Ø§Ø´Ø¯ØŒ Ø§Ø² `order.customerPhone` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ø§ÙØ²ÙˆØ¯Ù† logging Ø¨Ø±Ø§ÛŒ debugging

3. **Ø¨Ù‡Ø¨ÙˆØ¯ SMS Logging:**
   - Ø§ÙØ²ÙˆØ¯Ù† validation Ø¨Ø±Ø§ÛŒ phone number format
   - Logging Ø¨Ù‡ØªØ± Ø¨Ø±Ø§ÛŒ debugging
   - Ù†Ù…Ø§ÛŒØ´ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ± Ø¯Ø± logs

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/[locale]/checkout/CheckoutPageClient.tsx` - Ø§ÙØ²ÙˆØ¯Ù† redirect Ø¨Ù‡ success page
- `src/app/api/payment/zarinpal/callback/route.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ SMS phone number Ùˆ logging
- `src/app/api/customer/orders/route.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ SMS logging
- `src/lib/sms.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ validation Ùˆ logging

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Checkout Page - Redirect to success if orderNumber and refId present
useEffect(() => {
  const orderNumber = searchParams.get("orderNumber");
  const refId = searchParams.get("refId");
  const error = searchParams.get("error");
  
  // If we have orderNumber and refId without error, redirect to success page
  if (orderNumber && refId && !error) {
    router.replace(`/${locale}/checkout/success?orderNumber=${orderNumber}&refId=${refId}`);
    return;
  }
}, [searchParams, locale, router]);

// Payment Callback - Use customerPhone as fallback
const customerPhone = updatedOrder.user.phone || updatedOrder.customerPhone;
if (customerPhone) {
  // ... send SMS
} else {
  console.warn('âš ï¸ [Payment Callback] No phone number found for SMS');
}

// SMS Library - Phone validation and better logging
const phoneDigits = options.receptor.replace(/\D/g, '');
if (phoneDigits.length !== 11 || !phoneDigits.startsWith('09')) {
  console.error(`[SMS] Invalid phone number format:`, options.receptor);
  return;
}
```

**Ù†Ú©Ø§Øª Ù…Ù‡Ù…:**
1. **Redirect Logic:**
   - Check Ø¨Ø±Ø§ÛŒ orderNumber Ùˆ refId Ø¨Ø§ÛŒØ¯ Ù‚Ø¨Ù„ Ø§Ø² error handling Ø¨Ø§Ø´Ø¯
   - ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±Øª Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ error redirect Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯

2. **Phone Number:**
   - Ø§ÙˆÙ„ Ø§Ø² `user.phone` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨Ø§Ø´Ø¯ØŒ Ø§Ø² `order.customerPhone` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
   - Phone number Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ ÙØ±Ù…Øª `09xxxxxxxxx` Ø¨Ø§Ø´Ø¯

3. **SMS Validation:**
   - Phone number Ø¨Ø§ÛŒØ¯ 11 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯
   - Ø¨Ø§ÛŒØ¯ Ø¨Ø§ `09` Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯
   - Ø§Ú¯Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ØŒ SMS Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ error log Ù…ÛŒâ€ŒØ´ÙˆØ¯

4. **Logging:**
   - ØªÙ…Ø§Ù… SMS attempts log Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
   - Success Ùˆ failure Ù‡Ø± Ø¯Ùˆ log Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
   - Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ø¨Ø±Ø§ÛŒ debugging

---

**ØªØ§Ø±ÛŒØ®:** 2025-01-XX
**ÙˆØ¶Ø¹ÛŒØª:** âœ… ØªÙ…Ø§Ù… Ù…Ø´Ú©Ù„Ø§Øª Ø±ÙØ¹ Ø´Ø¯Ù‡

---

## âœ… ØªØºÛŒÛŒØ± Ø¨Ø²Ø±Ú¯: Ø­Ø°Ù Ø¢Ø¯Ø±Ø³ ØµÙˆØ±ØªØ­Ø³Ø§Ø¨ (Billing Address)

### ğŸ“… ØªØ§Ø±ÛŒØ®: 2025-01-XX

### ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡:

#### 1. **Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ… Ø¢Ø¯Ø±Ø³**
- Ø­Ø°Ù Ú©Ø§Ù…Ù„ Ø¢Ø¯Ø±Ø³ ØµÙˆØ±ØªØ­Ø³Ø§Ø¨ (Billing Address) Ø§Ø² Ø³ÛŒØ³ØªÙ…
- ÙÙ‚Ø· Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„ (Shipping Address) Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø§Ø³Øª
- Ø§ÛŒÙ† ØªØºÛŒÛŒØ± Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Ø¯Ø± Ø³Ø±Ø§Ø³Ø± Ù¾Ù„ØªÙØ±Ù… Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª

#### 2. **ØªØºÛŒÛŒØ±Ø§Øª Ø¯ÛŒØªØ§Ø¨ÛŒØ³**
- Ø­Ø°Ù `billingAddressId` Ø§Ø² Ø¬Ø¯ÙˆÙ„ `orders`
- Ø­Ø°Ù `billingOrders` relation Ø§Ø² Ø¬Ø¯ÙˆÙ„ `addresses`
- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ `AddressType` enum: Ø­Ø°Ù `BILLING` Ùˆ `BOTH`ØŒ ÙÙ‚Ø· `SHIPPING` Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡
- Migration Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡: `remove_billing_address`

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `prisma/schema.prisma` - Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Order Ùˆ Address
- Migration file Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³

#### 3. **ØªØºÛŒÛŒØ±Ø§Øª API Routes**
- Ø­Ø°Ù `billingAddress` Ø§Ø² ØªÙ…Ø§Ù… API responses
- Ø­Ø°Ù Ø§ÛŒØ¬Ø§Ø¯ `billingAddress` Ø¯Ø± order creation
- Ø­Ø°Ù validation Ø¨Ø±Ø§ÛŒ `billingAddress`
- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙ…Ø§Ù… endpoints Ù…Ø±ØªØ¨Ø· Ø¨Ø§ orders

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/orders/route.ts` - Ø­Ø°Ù billing address Ø§Ø² order creation
- `src/app/api/customer/orders/[id]/route.ts` - Ø­Ø°Ù billing address Ø§Ø² responses
- `src/app/api/orders/route.ts` - Ø­Ø°Ù billing address Ø§Ø² admin order list
- `src/app/api/orders/[id]/route.ts` - Ø­Ø°Ù billing address Ø§Ø² admin order details
- `src/app/api/crm/quotes/[id]/convert/route.ts` - Ø­Ø°Ù billing address Ø§Ø² quote conversion
- `src/app/api/customer/addresses/[id]/route.ts` - Ø­Ø°Ù billing address check Ø§Ø² delete validation

#### 4. **ØªØºÛŒÛŒØ±Ø§Øª Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§**

**Checkout Components:**
- `src/app/[locale]/checkout/CheckoutPageClient.tsx` - Ø­Ø°Ù state Ùˆ logic Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ billing address
- `src/components/checkout/CheckoutAddressSelector.tsx` - Ø­Ø°Ù Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ billing address
- `src/components/checkout/AddressFormModal.tsx` - Ø­Ø°Ù Ù†ÙˆØ¹ billing Ø§Ø² modal

**Order Display Components:**
- `src/components/customer/orders/OrderDetails.tsx` - Ø­Ø°Ù Ù†Ù…Ø§ÛŒØ´ billing address
- `src/app/[locale]/checkout/success/page.tsx` - Ø­Ø°Ù Ù†Ù…Ø§ÛŒØ´ billing address

**Address Management:**
- `src/components/customer/addresses/AddressForm.tsx` - Ø­Ø°Ù Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ BILLING Ùˆ BOTH Ø§Ø² dropdown
- `src/components/customer/addresses/AddressList.tsx` - Ø­Ø°Ù handling Ø¨Ø±Ø§ÛŒ BILLING Ùˆ BOTH types

#### 5. **ØªØºÛŒÛŒØ±Ø§Øª Types**
- Ø­Ø°Ù `billingAddress` Ø§Ø² ØªÙ…Ø§Ù… type definitions
- Ø­Ø°Ù `billingAddressId` Ø§Ø² AdminOrder interface
- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ CustomerOrder interface

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/types/admin.ts` - Ø­Ø°Ù billingAddress Ø§Ø² AdminOrder
- `src/contexts/CustomerContext.tsx` - Ø­Ø°Ù billingAddress Ø§Ø² CustomerOrder interface
- `src/lib/i18n.ts` - Ø­Ø°Ù billingAddress Ø§Ø² type definitions (translations Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯ Ø¨Ø±Ø§ÛŒ backward compatibility)

#### 6. **ØªØºÛŒÛŒØ±Ø§Øª UI/UX**
- ØµÙØ­Ù‡ checkout: ÙÙ‚Ø· ÛŒÚ© Ø¨Ø®Ø´ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„
- ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´: ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„
- ØµÙØ­Ù‡ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª: ÙÙ‚Ø· Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„
- Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§: ÙÙ‚Ø· Ø§Ù…Ú©Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø§Ø±Ø³Ø§Ù„

### Ù…Ù†Ø·Ù‚ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±:

#### Ù‚ÙˆØ§Ù†ÛŒÙ† Ø¬Ø¯ÛŒØ¯:
- âœ… ÙÙ‚Ø· ÛŒÚ© Ù†ÙˆØ¹ Ø¢Ø¯Ø±Ø³: SHIPPING
- âœ… ØªÙ…Ø§Ù… Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ù†ÙˆØ¹ SHIPPING Ø¨Ø§Ø´Ù†Ø¯
- âœ… Ù‡Ù†Ú¯Ø§Ù… Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ§Ø±Ø´ØŒ ÙÙ‚Ø· shipping address Ù„Ø§Ø²Ù… Ø§Ø³Øª
- âœ… Ø¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ØŒ ÙÙ‚Ø· shipping address Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯

### Migration Steps:

1. **Ø§Ø¹Ù…Ø§Ù„ Migration:**
   ```bash
   npx prisma migrate dev
   ```

2. **Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯:**
   - Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§ Ù†ÙˆØ¹ BILLING ÛŒØ§ BOTH Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ SHIPPING ØªØ¨Ø¯ÛŒÙ„ Ø´ÙˆÙ†Ø¯
   - Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ú©Ù‡ billingAddressId Ø¯Ø§Ø±Ù†Ø¯ Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆÙ†Ø¯

3. **Data Migration (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²):**
   - Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø¨Ø§ÛŒØ¯ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø¹Ù…Ø§Ù„ migrationØŒ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ BILLING/BOTH Ø±Ø§ Ø¨Ù‡ SHIPPING ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†ÛŒØ¯
   - ÛŒØ§ Ø§Ø² migration script Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯

### ØªØ³Øª:
1. âœ… Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ ÙÙ‚Ø· shipping address
2. âœ… Ù†Ù…Ø§ÛŒØ´ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ (Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· shipping address Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡Ø¯)
3. âœ… Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ (Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· SHIPPING Ø¨Ø§Ø´Ø¯)
4. âœ… Ø§Ù†ØªØ®Ø§Ø¨ Ø¢Ø¯Ø±Ø³ Ø¯Ø± checkout (Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· shipping addresses Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡Ø¯)
5. âœ… ØªØ¨Ø¯ÛŒÙ„ quote Ø¨Ù‡ order (Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· shipping address Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø¯)

### Ù†Ú©Ø§Øª Ù…Ù‡Ù…:
- **Backward Compatibility:** ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ billing address Ø¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ translation Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯ Ø§Ù…Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- **Existing Data:** Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø¨Ø§ÛŒØ¯ migration script Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ BILLING/BOTH Ø¨Ù‡ SHIPPING Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯
- **Database:** Migration Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ø¯Ù‚Øª Ø§Ø¹Ù…Ø§Ù„ Ø´ÙˆØ¯ ØªØ§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø² Ø¯Ø³Øª Ù†Ø±ÙˆÙ†Ø¯

---

---

## âœ… ÙˆÛŒÚ˜Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯: Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§

### ğŸ“… ØªØ§Ø±ÛŒØ®: 2025-12-06

### ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:

#### 1. **Ù¾Ø±Ø¯Ø§Ø®Øª Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ†Ø´Ø¯Ù‡**
- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ†Ø´Ø¯Ù‡ Ø±Ø§ Ø§Ø² ØµÙØ­Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø³ÙØ§Ø±Ø´Ø§Øª ÛŒØ§ Ø¬Ø²Ø¦ÛŒØ§Øª Ø³ÙØ§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ù†Ù†Ø¯
- Ø¯Ú©Ù…Ù‡ "Ù¾Ø±Ø¯Ø§Ø®Øª" ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø§ `paymentStatus = PENDING` Ùˆ `status != CANCELLED/DELIVERED/REFUNDED` Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² endpoint Ù…ÙˆØ¬ÙˆØ¯ `/api/payment/zarinpal/request` Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª
- Ù‡Ø¯Ø§ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/components/customer/orders/OrderHistory.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ handler
- `src/components/customer/orders/OrderDetails.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ handler

#### 2. **Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§**
- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ Ø±Ø§ Ù„ØºÙˆ Ú©Ù†Ù†Ø¯
- Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ: Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ `status != CANCELLED/DELIVERED/REFUNDED`
- Ù¾Ø³ Ø§Ø² Ù„ØºÙˆØŒ `status` Ø³ÙØ§Ø±Ø´ Ø¨Ù‡ `CANCELLED` ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
- ØªØ§ÛŒÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„ Ø§Ø² Ù„ØºÙˆ (confirmation dialog)

**API Endpoint Ø¬Ø¯ÛŒØ¯:**
- `PATCH /api/customer/orders/[id]` - Ø¨Ø±Ø§ÛŒ Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´
  - Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø³ÙØ§Ø±Ø´ Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ Ø§Ø³Øª
  - Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ `status` Ø¨Ù‡ `CANCELLED`
  - Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÙØ§Ø±Ø´ Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯Ù‡

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/orders/[id]/route.ts` - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† PATCH endpoint
- `src/components/customer/orders/OrderHistory.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù„ØºÙˆ Ùˆ handler
- `src/components/customer/orders/OrderDetails.tsx` - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù„ØºÙˆ Ùˆ handler

#### 3. **Ø­Ø°Ù Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)**
- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ†Ø´Ø¯Ù‡ Ùˆ Ø§Ø±Ø³Ø§Ù„â€ŒÙ†Ø´Ø¯Ù‡ Ø±Ø§ Ø­Ø°Ù Ú©Ù†Ù†Ø¯
- Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø­Ø°Ù:
  - `paymentStatus = PENDING` ÛŒØ§ `FAILED`
  - `status = PENDING` ÛŒØ§ `CONFIRMED` ÛŒØ§ `CANCELLED`
  - `shippedAt = null` (Ù‡Ù†ÙˆØ² Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡)

**API Endpoint Ø¬Ø¯ÛŒØ¯:**
- `DELETE /api/customer/orders/[id]` - Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø³ÙØ§Ø±Ø´
  - Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø³ÙØ§Ø±Ø´ Ù‚Ø§Ø¨Ù„ Ø­Ø°Ù Ø§Ø³Øª
  - Ø­Ø°Ù Ø³ÙØ§Ø±Ø´ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ (cascade delete Ø¨Ø±Ø§ÛŒ orderItems)

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/orders/[id]/route.ts` - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† DELETE endpoint

#### 4. **ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§**
- Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ Ø¬Ø¯ÛŒØ¯:
  - `customer.orders.payNow` - "Ù¾Ø±Ø¯Ø§Ø®Øª"
  - `customer.orders.cancelOrder` - "Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´"
  - `customer.orders.cancelOrderConfirm` - "Ø¢ÛŒØ§ Ø§Ø² Ù„ØºÙˆ Ø§ÛŒÙ† Ø³ÙØ§Ø±Ø´ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ"
  - `customer.orders.cancelOrderSuccess` - "Ø³ÙØ§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù„ØºÙˆ Ø´Ø¯"
  - `customer.orders.cancelOrderError` - "Ø®Ø·Ø§ Ø¯Ø± Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´"
  - `customer.orders.paymentRequestFailed` - "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª"
  - `customer.orders.paymentError` - "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø®Øª"
  - `customer.orderDetails.payNowButton` - "Ù¾Ø±Ø¯Ø§Ø®Øª Ø³ÙØ§Ø±Ø´"
  - `customer.orderDetails.cancelOrderButton` - "Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´"
  - Ùˆ Ø³Ø§ÛŒØ± Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø·

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `messages/fa.json` - Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† ØªØ±Ø¬Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ

### Ù…Ù†Ø·Ù‚ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±:

#### Ù‚ÙˆØ§Ù†ÛŒÙ† Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´:
- âœ… Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ: Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø§ `paymentStatus != PAID` Ùˆ `status != CANCELLED/DELIVERED/REFUNDED`
- âŒ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ù„ØºÙˆ: Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡ (`PAID`), `CANCELLED`, `DELIVERED`, `REFUNDED`

#### Ù‚ÙˆØ§Ù†ÛŒÙ† Ø­Ø°Ù Ø³ÙØ§Ø±Ø´:
- âœ… Ù‚Ø§Ø¨Ù„ Ø­Ø°Ù: Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ†Ø´Ø¯Ù‡ (`PENDING` ÛŒØ§ `FAILED`) Ú©Ù‡ Ù‡Ù†ÙˆØ² Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
- âŒ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø­Ø°Ù: Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡ØŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ØŒ ÛŒØ§ ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡

#### Ù‚ÙˆØ§Ù†ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø®Øª:
- âœ… Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª: Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒÛŒ Ø¨Ø§ `paymentStatus = PENDING` Ú©Ù‡ `status != CANCELLED/DELIVERED/REFUNDED`
- âŒ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª: Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡ ÛŒØ§ Ù„ØºÙˆ Ø´Ø¯Ù‡

### ØªØ³Øª:
1. âœ… Ø§ÛŒØ¬Ø§Ø¯ Ø³ÙØ§Ø±Ø´ Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù† Ø§Ø² ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª
2. âœ… Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ†Ø´Ø¯Ù‡
3. âœ… ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù„ØºÙˆ Ø³ÙØ§Ø±Ø´ ØªØ­ÙˆÛŒÙ„ Ø´Ø¯Ù‡ (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¨Ø¯Ù‡Ø¯)
4. âœ… Ø­Ø°Ù Ø³ÙØ§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ†Ø´Ø¯Ù‡
5. âœ… ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø³ÙØ§Ø±Ø´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡ (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¨Ø¯Ù‡Ø¯)

---

## âœ… Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ùˆ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ: Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³

### ğŸ“… ØªØ§Ø±ÛŒØ®: 2025-01-XX

### Ù…Ø´Ú©Ù„Ø§Øª Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡:

#### 1. **Ø¹Ø¯Ù… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Transaction**
- Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ… Ø¢Ø¯Ø±Ø³ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ù…ÛŒâ€ŒØ´Ø¯ØŒ Ø¢Ø¯Ø±Ø³ Ù‡Ù…Ú†Ù†Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´Ø¯
- Ø§Ù…Ú©Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ ÙˆØ¶Ø¹ÛŒØª Ù†Ø§Ø³Ø§Ø²Ú¯Ø§Ø± Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³

#### 2. **Ø¹Ø¯Ù… Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±**
- Ø¢Ø¯Ø±Ø³ Ø¨Ø¯ÙˆÙ† Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´Ø¯
- Ø§Ù…Ú©Ø§Ù† Ø®Ø·Ø§ÛŒ Foreign Key Constraint

#### 3. **Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†Ø§Ù‚Øµ**
- Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…Øª (Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†ØŒ Ú©Ø¯ Ù¾Ø³ØªÛŒ) ÙÙ‚Ø· Ø¯Ø± frontend Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´Ø¯
- Ø¹Ø¯Ù… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„ ÙÛŒÙ„Ø¯Ù‡Ø§
- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ

#### 4. **Ø¹Ø¯Ù… Ø«Ø¨Øª Ø®Ø·Ø§Ù‡Ø§**
- Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ ÙÙ‚Ø· Ø¯Ø± console Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´Ø¯Ù†Ø¯
- Ø¹Ø¯Ù… Ø«Ø¨Øª Ø¬Ø²Ø¦ÛŒØ§Øª ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚

### ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯Ù‡:

#### 1. **Ø§Ù…Ù†ÛŒØª Transaction**
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `prisma.$transaction` Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² atomicity
- Ø§Ú¯Ø± ØªÙ†Ø¸ÛŒÙ… Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´ÙˆØ¯ØŒ Ø¢Ø¯Ø±Ø³ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
- Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ ÙˆØ¶Ø¹ÛŒØª Ù†Ø§Ø³Ø§Ø²Ú¯Ø§Ø±

**ÙØ§ÛŒÙ„ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/addresses/route.ts` - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² transaction

#### 2. **Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±**
- Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³
- Ø¨Ø±Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ
- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­â€ŒØªØ±

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Verify user exists in database before creating address
const userExists = await prisma.user.findUnique({
  where: { id: session.user.id },
  select: { id: true, email: true, isActive: true }
});

if (!userExists) {
  return NextResponse.json(
    { success: false, error: "User account not found. Please log out and log in again." },
    { status: 404 }
  );
}

if (!userExists.isActive) {
  return NextResponse.json(
    { success: false, error: "Your account has been deactivated. Please contact support." },
    { status: 403 }
  );
}
```

#### 3. **Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¬Ø§Ù…Ø¹**

**Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ:**
- Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ
- Trim Ú©Ø±Ø¯Ù† ÙØ¶Ø§Ù‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ

**Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„:**
- Title: Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±
- First Name: Ø­Ø¯Ø§Ú©Ø«Ø± 50 Ú©Ø§Ø±Ø§Ú©ØªØ±
- Last Name: Ø­Ø¯Ø§Ú©Ø«Ø± 50 Ú©Ø§Ø±Ø§Ú©ØªØ±
- Company: Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±
- Address Line 1: Ø­Ø¯Ø§Ú©Ø«Ø± 200 Ú©Ø§Ø±Ø§Ú©ØªØ±
- Address Line 2: Ø­Ø¯Ø§Ú©Ø«Ø± 200 Ú©Ø§Ø±Ø§Ú©ØªØ±
- City: Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±
- State: Ø­Ø¯Ø§Ú©Ø«Ø± 100 Ú©Ø§Ø±Ø§Ú©ØªØ±
- Postal Code: Ø­Ø¯Ø§Ú©Ø«Ø± 20 Ú©Ø§Ø±Ø§Ú©ØªØ±
- Phone: Ø­Ø¯Ø§Ú©Ø«Ø± 20 Ú©Ø§Ø±Ø§Ú©ØªØ±

**Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…Øª:**
- Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†: ÙØ±Ù…Øª Ø§ÛŒØ±Ø§Ù†ÛŒ (`/^(\+98|0)?9\d{9}$/`)
- Ú©Ø¯ Ù¾Ø³ØªÛŒ: Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ 10 Ø±Ù‚Ù… (`/^\d{10}$/`)

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/addresses/route.ts` - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¬Ø§Ù…Ø¹ Ø¯Ø± API
- `src/components/customer/addresses/AddressForm.tsx` - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„ Ø¯Ø± frontend

#### 4. **Ø«Ø¨Øª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§**

**Ø«Ø¨Øª Ø®Ø·Ø§Ù‡Ø§ÛŒ ØªÙØµÛŒÙ„ÛŒ:**
- Ø«Ø¨Øª Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ùˆ Ù¾Ø§ÛŒØ§Ù† Ø¹Ù…Ù„ÛŒØ§Øª
- Ø«Ø¨Øª Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø·Ø§ (message, stack, addressData)
- Ø«Ø¨Øª Ø®Ø·Ø§Ù‡Ø§ÛŒ Prisma (P2003, P2002, P2025)
- Ø¹Ø¯Ù… Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø³ (Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ùˆ Ú©Ø¯ Ù¾Ø³ØªÛŒ Ø¨Ù‡ ØµÙˆØ±Øª `***`)

**Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­:**
- Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ: Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ù…Ø´Ú©Ù„Ø§Øª
- Ø®Ø·Ø§Ù‡Ø§ÛŒ Foreign Key: Ù¾ÛŒØ§Ù… ÙˆØ§Ø¶Ø­ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
- Ø®Ø·Ø§Ù‡Ø§ÛŒ Unique Constraint: Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨
- Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡: Ù¾ÛŒØ§Ù… ÙˆØ§Ø¶Ø­ Ø¨Ø§ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/addresses/route.ts` - Ø«Ø¨Øª Ø®Ø·Ø§Ù‡Ø§ÛŒ ØªÙØµÛŒÙ„ÛŒ
- `src/contexts/CustomerContext.tsx` - Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ù‡ØªØ± Ø®Ø·Ø§Ù‡Ø§ Ø¯Ø± frontend
- `src/components/checkout/AddressFormModal.tsx` - Ø¨Ù‡Ø¨ÙˆØ¯ error handling

#### 5. **Ø¨Ù‡Ø¨ÙˆØ¯ Frontend**

**Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„ Ø¯Ø± ÙØ±Ù…:**
- Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„ ÙÛŒÙ„Ø¯Ù‡Ø§ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„
- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙÛŒÙ„Ø¯

**Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§:**
- Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ØªÙØµÛŒÙ„ÛŒ Ø§Ø² API
- Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡
- Ø«Ø¨Øª Ø®Ø·Ø§Ù‡Ø§ Ø¯Ø± console Ø¨Ø±Ø§ÛŒ debugging

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/components/customer/addresses/AddressForm.tsx` - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø·ÙˆÙ„
- `src/contexts/CustomerContext.tsx` - Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ù‡ØªØ± Ø®Ø·Ø§Ù‡Ø§
- `src/components/checkout/AddressFormModal.tsx` - Ø¨Ù‡Ø¨ÙˆØ¯ error handling

### Ù…Ù†Ø·Ù‚ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±:

#### Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ:
- âœ… ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ù¾Ø± Ø´ÙˆÙ†Ø¯
- âœ… Ø·ÙˆÙ„ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ø¬Ø§Ø² Ø¨Ø§Ø´Ø¯
- âœ… Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ø¨Ø§ÛŒØ¯ ÙØ±Ù…Øª Ø§ÛŒØ±Ø§Ù†ÛŒ Ù…Ø¹ØªØ¨Ø± Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- âœ… Ú©Ø¯ Ù¾Ø³ØªÛŒ Ø¨Ø§ÛŒØ¯ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ 10 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯
- âœ… Ù†ÙˆØ¹ Ø¢Ø¯Ø±Ø³ Ø¨Ø§ÛŒØ¯ `SHIPPING` Ø¨Ø§Ø´Ø¯

#### Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ù…Ù†ÛŒØªÛŒ:
- âœ… Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- âœ… Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯
- âœ… ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø± transaction Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯
- âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø³ Ø¯Ø± Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø«Ø¨Øª Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯

### ØªØ³Øª:
1. âœ… Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¨Ø§ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±
2. âœ… ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¨Ø§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¨Ø¯Ù‡Ø¯)
3. âœ… ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ† Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¨Ø¯Ù‡Ø¯)
4. âœ… ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¨Ø§ Ú©Ø¯ Ù¾Ø³ØªÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¨Ø¯Ù‡Ø¯)
5. âœ… ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¨Ø§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒ (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¨Ø¯Ù‡Ø¯)
6. âœ… Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø¨Ø§ÛŒØ¯ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ ØºÛŒØ±Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ú©Ù†Ø¯)
7. âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø«Ø¨Øª Ø®Ø·Ø§Ù‡Ø§ Ø¯Ø± console
8. âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±

### Ù†Ú©Ø§Øª Ù…Ù‡Ù…:
- **Transaction Safety:** ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø± transaction Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§ Ø§Ø² Ù†Ø§Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø´ÙˆØ¯
- **Error Logging:** ØªÙ…Ø§Ù… Ø®Ø·Ø§Ù‡Ø§ Ø¨Ø§ Ø¬Ø²Ø¦ÛŒØ§Øª Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ø§Ù…Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø³ Ù…Ø­Ø§ÙØ¸Øª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- **User Verification:** Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø¯Ø±Ø³ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- **Comprehensive Validation:** Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø± API Ùˆ Frontend Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯
- **Better UX:** Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­ Ùˆ Ù…ÙÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±

---

## âœ… Ø±ÙØ¹ Ù…Ø´Ú©Ù„: Ø®Ø·Ø§ÛŒ Foreign Key Constraint Ø¯Ø± Ø­Ø°Ù Ø¢Ø¯Ø±Ø³

### ğŸ“… ØªØ§Ø±ÛŒØ®: 2025-01-XX

### Ù…Ø´Ú©Ù„:
- Ù¾Ø³ Ø§Ø² Ø­Ø°Ù Ø¢Ø¯Ø±Ø³ØŒ ØµÙØ­Ù‡ reload Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø®Ø·Ø§ÛŒ "Internal server error" Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- Ø®Ø·Ø§ÛŒ `Foreign key constraint violated on the constraint: orders_billingAddressId_fkey`
- Ø§ÛŒÙ† Ø®Ø·Ø§ Ø­ØªÛŒ Ù¾Ø³ Ø§Ø² migration Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù `billingAddressId` Ø±Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ "ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯" Ù…Ø´Ú©Ù„ Ø­Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø§Ù…Ø§ ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø¯ Ø§Ø³Øª

### Ø¹Ù„Øª:
- Constraint `orders_billingAddressId_fkey` Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù‡Ù†ÙˆØ² Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
- Migration Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ù‡ Ø·ÙˆØ± Ú©Ø§Ù…Ù„ Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
- Error handling Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø®Ø·Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª
- Frontend Ù¾Ø³ Ø§Ø² Ø®Ø·Ø§ØŒ ØµÙØ­Ù‡ Ø±Ø§ reload Ù…ÛŒâ€ŒÚ©Ø±Ø¯

### Ø±Ø§Ù‡â€ŒØ­Ù„:

#### 1. **Ø¨Ù‡Ø¨ÙˆØ¯ Error Handling Ø¯Ø± API**
- Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù† Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ø¨Ø±Ø§ÛŒ foreign key constraint errors
- Ø¨Ø±Ø±Ø³ÛŒ legacy `billingAddressId` constraint
- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
- Ø«Ø¨Øª Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ debugging

**ÙØ§ÛŒÙ„ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/app/api/customer/addresses/[id]/route.ts` - Ø¨Ù‡Ø¨ÙˆØ¯ error handling Ø¯Ø± DELETE endpoint

**Ú©Ø¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:**
```typescript
// Handle Prisma foreign key constraint errors
if (error instanceof Prisma.PrismaClientKnownRequestError) {
  if (error.code === 'P2003') {
    const constraintName = error.meta?.field_name || (error.meta as any)?.constraint || 'unknown';
    
    // Check if it's the billing address constraint (legacy)
    if (constraintStr.includes('billingAddressId')) {
      return NextResponse.json(
        { 
          success: false, 
          error: "Cannot delete address that is used in orders. The database migration may not be complete. Please contact support." 
        },
        { status: 400 }
      );
    }
  }
}
```

#### 2. **Ø¨Ù‡Ø¨ÙˆØ¯ Migration Script**
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² DO block Ø¨Ø±Ø§ÛŒ drop Ú©Ø±Ø¯Ù† constraint Ø¨Ø§ error handling Ø¨Ù‡ØªØ±
- Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ constraint Ù‚Ø¨Ù„ Ø§Ø² drop Ú©Ø±Ø¯Ù†

**ÙØ§ÛŒÙ„ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `prisma/migrations/20250101000000_remove_billing_address/migration.sql` - Ø¨Ù‡Ø¨ÙˆØ¯ migration script

#### 3. **Ø¨Ù‡Ø¨ÙˆØ¯ Frontend Error Handling**
- Ø¹Ø¯Ù… reload ØµÙØ­Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
- Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± modal Ø­Ø°Ù
- Ø¹Ø¯Ù… Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ù„ÛŒØ³Øª Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø¨Ø§ ØµÙØ­Ù‡ Ø®Ø·Ø§ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ÛŒ Ø­Ø°Ù
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `fetchAddresses()` Ø¨Ù‡ Ø¬Ø§ÛŒ `window.location.reload()` Ø¨Ø±Ø§ÛŒ retry
- Ù†Ù…Ø§ÛŒØ´ loading state Ø¯Ø± modal Ø­Ø°Ù
- Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ Ø¯Ø± modal Ø¨Ù‡ Ø¬Ø§ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ú©Ù„ ØµÙØ­Ù‡

**ÙØ§ÛŒÙ„ ØªØºÛŒÛŒØ± ÛŒØ§ÙØªÙ‡:**
- `src/contexts/CustomerContext.tsx` - Ø¨Ù‡Ø¨ÙˆØ¯ error handling Ø¯Ø± `deleteAddress` (Ø¹Ø¯Ù… set Ú©Ø±Ø¯Ù† loading state)
- `src/components/customer/addresses/AddressList.tsx` - Ù†Ù…Ø§ÛŒØ´ Ø®Ø·Ø§ Ø¯Ø± modal Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ UX

#### 4. **Script Ø¨Ø±Ø§ÛŒ Fix Manual**
- Ø§ÛŒØ¬Ø§Ø¯ script SQL Ø¨Ø±Ø§ÛŒ drop Ú©Ø±Ø¯Ù† constraint Ø¨Ù‡ ØµÙˆØ±Øª manual Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²

**ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯:**
- `scripts/fix_billing_address_constraint.sql` - Script Ø¨Ø±Ø§ÛŒ fix Ú©Ø±Ø¯Ù† constraint

### ØªØ³Øª:
1. âœ… Ø­Ø°Ù Ø¢Ø¯Ø±Ø³ Ú©Ù‡ Ø¯Ø± orders Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡ (Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ø¯)
2. âœ… Ø­Ø°Ù Ø¢Ø¯Ø±Ø³ Ú©Ù‡ Ø¯Ø± orders Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­ Ø¯Ø± modal Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡Ø¯)
3. âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ù… reload ØµÙØ­Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
4. âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­ Ø¯Ø± modal Ø­Ø°Ù
5. âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ù… Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ù„ÛŒØ³Øª Ø¨Ø§ ØµÙØ­Ù‡ Ø®Ø·Ø§
6. âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù…Ø§ÛŒØ´ loading state Ø¯Ø± modal
7. âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø«Ø¨Øª Ø®Ø·Ø§Ù‡Ø§ Ø¯Ø± console
8. âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `fetchAddresses()` Ø¨Ù‡ Ø¬Ø§ÛŒ `window.location.reload()`

### Ù†Ú©Ø§Øª Ù…Ù‡Ù…:
- **Migration Check:** Ø§Ú¯Ø± Ø®Ø·Ø§ Ø§Ø¯Ø§Ù…Ù‡ Ø¯Ø§Ø±Ø¯ØŒ script `fix_billing_address_constraint.sql` Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯
- **Error Messages:** Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ ÙˆØ§Ø¶Ø­ Ùˆ Ù…ÙÛŒØ¯ Ù‡Ø³ØªÙ†Ø¯ Ùˆ Ø¯Ø± modal Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
- **No Page Reload:** ØµÙØ­Ù‡ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ reload Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ø§Ø² `fetchAddresses()` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
- **Better UX:** 
  - Ø®Ø·Ø§Ù‡Ø§ Ø¯Ø± modal Ø­Ø°Ù Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ØŒ Ù†Ù‡ Ø¯Ø± Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ú©Ù„ ØµÙØ­Ù‡
  - Ù„ÛŒØ³Øª Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ÛŒ Ø­Ø°Ù Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯
  - Loading state Ø¯Ø± modal Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
  - Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØ¯Ø§Ù†Ø¯ Ú†Ø±Ø§ Ø¢Ø¯Ø±Ø³ Ø­Ø°Ù Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª

### Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Fix Script:
- Script `fix_billing_address_constraint.sql` Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù‡ Ø§Ø³Øª
- Constraint `orders_billingAddressId_fkey` Ùˆ column `billingAddressId` Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø­Ø°Ù Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
- Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ú©Ù†ÙˆÙ† Ø¨Ø§ schema Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø§Ø³Øª

